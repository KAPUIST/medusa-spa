# ECS Fargate vs EC2 비교 (노션 정리용)

## 📋 목차

1. [한 줄 요약](#한-줄-요약)
2. [EC2 방식 (전통적)](#ec2-방식-전통적)
3. [ECS Fargate 방식 (현대적)](#ecs-fargate-방식-현대적)
4. [상세 비교표](#상세-비교표)
5. [실제 사용 경험 비교](#실제-사용-경험-비교)
6. [언제 무엇을 사용할까](#언제-무엇을-사용할까)

---

## 한 줄 요약

> **EC2**: 가상 서버를 빌려서 직접 관리
> **ECS Fargate**: 컨테이너만 올리면 AWS가 알아서 관리

---

## EC2 방식 (전통적)

### 개념

실제 **서버**(가상 머신)를 빌려서 직접 관리하는 방식

### 구조

```
┌─────────────────────────────────┐
│      EC2 인스턴스 (서버)         │
│  ┌───────────────────────────┐  │
│  │   운영체제 (Ubuntu)       │  │
│  │  ┌────────────────────┐   │  │
│  │  │   Docker 설치      │   │  │
│  │  │  ┌─────────────┐   │   │  │
│  │  │  │ 앱 컨테이너  │   │   │  │
│  │  │  └─────────────┘   │   │  │
│  │  └────────────────────┘   │  │
│  └───────────────────────────┘  │
└─────────────────────────────────┘
```

### 배포 과정

```bash
# 1. SSH로 서버 접속
ssh ubuntu@ec2-xxx.amazonaws.com

# 2. 코드 다운로드
git pull origin main

# 3. Docker 이미지 빌드
docker build -t myapp .

# 4. 컨테이너 실행
docker-compose up -d

# 5. 확인
docker ps
```

### 관리해야 할 것들

#### ❌ 직접 관리 필요

- **서버 선택**: t3.micro? t3.medium? 몇 대?
- **OS 설치**: Ubuntu 22.04 설치
- **보안 패치**: `sudo apt update && sudo apt upgrade`
- **Docker 설치**: Docker, Docker Compose 설치
- **Nginx 설정**: 리버스 프록시 설정
- **SSL 인증서**: Let's Encrypt 설정
- **로그 관리**: 로그가 쌓여서 디스크 가득 참
- **모니터링**: CPU/메모리 직접 확인
- **백업**: 스냅샷 직접 생성
- **재시작**: 서버 죽으면 직접 재시작
- **스케일링**: 트래픽 늘면 서버 수동 추가

#### ✅ 장점

- 완전한 통제권 (root 권한)
- SSH로 직접 접속 가능
- 디버깅 쉬움 (서버 안에 들어가서 확인)
- 비용 예측 가능 (월 고정 비용)

#### ❌ 단점

- 관리 부담 큼
- 서버 관리 지식 필요
- 24시간 켜놓으면 비용 계속 발생
- 스케일링 수동
- 장애 발생 시 직접 대응

### 비용 (예시)

```
EC2 t3.small (2GB RAM)
├── 인스턴스: $0.0208/시간 × 24시간 × 30일 = $14.98/월
├── EBS 스토리지: 20GB × $0.10 = $2.00/월
└── 데이터 전송: 10GB × $0.09 = $0.90/월

총: $17.88/월 (약 24,000원)
```

---

## ECS Fargate 방식 (현대적)

### 개념

**컨테이너**만 실행하면 서버는 AWS가 알아서 관리

### 구조

```
┌─────────────────────────────────┐
│     AWS Fargate (서버리스)       │
│  ┌───────────────────────────┐  │
│  │   ??? (AWS가 관리)        │  │
│  │  ┌────────────────────┐   │  │
│  │  │  앱 컨테이너       │ ← 여기만 신경 쓰면 됨
│  │  └────────────────────┘   │  │
│  └───────────────────────────┘  │
└─────────────────────────────────┘
```

### 배포 과정

```bash
# 1. 로컬에서 Docker 이미지 빌드
docker build -t myapp .

# 2. ECR에 푸시
docker push 637423422501.dkr.ecr.ap-northeast-2.amazonaws.com/myapp

# 3. ECS Service 업데이트
aws ecs update-service --force-new-deployment

# 끝! (AWS가 알아서 컨테이너 실행)
```

### 자동으로 관리되는 것들

#### ✅ AWS가 알아서

- **서버 프로비저닝**: 자동으로 적절한 서버 할당
- **OS 관리**: 패치, 업데이트 자동
- **컨테이너 실행**: 이미지 pull, 실행, 모니터링
- **헬스체크**: 죽은 컨테이너 자동 재시작
- **로드밸런싱**: ALB 자동 연동
- **오토스케일링**: CPU 사용률에 따라 자동 증설
- **로그 수집**: CloudWatch Logs 자동 전송
- **보안 패치**: 인프라 레벨 자동 업데이트

#### ✅ 장점

- 서버 관리 불필요
- 자동 스케일링
- 무중단 배포 (Rolling Update)
- 사용한 만큼만 과금
- 높은 가용성 (Multi-AZ 자동)
- 컨테이너만 신경 쓰면 됨

#### ❌ 단점

- SSH 접속 불가 (디버깅 어려움)
- 완전한 통제권 없음
- 초기 설정 복잡 (하지만 한 번만)
- 비용이 약간 더 비쌈 (편의성 대가)

### 비용 (예시)

```
Fargate (0.5 vCPU, 1GB RAM)
├── vCPU: $0.04656/시간 × 24시간 × 30일 = $33.55/월
├── Memory: $0.00511/시간 × 24시간 × 30일 = $3.68/월
└── 데이터 전송: 10GB × $0.09 = $0.90/월

총: $38.13/월 (약 51,000원)

⚠️ 하지만 실제 사용 시간만 과금!
하루 8시간만 사용: $38.13 × (8/24) = $12.71/월
```

---

## 상세 비교표

| 항목                | EC2                           | ECS Fargate                 |
| ------------------- | ----------------------------- | --------------------------- |
| **서버 관리**       | ❌ 직접 관리 필요             | ✅ AWS가 자동 관리          |
| **OS 패치**         | ❌ `sudo apt update`          | ✅ 자동                     |
| **Docker 설치**     | ❌ 직접 설치                  | ✅ 필요 없음                |
| **앱 배포**         | SSH → docker-compose          | ECR 푸시 → 자동             |
| **재시작**          | ❌ 수동 (`systemctl restart`) | ✅ 자동 (헬스체크 실패 시)  |
| **스케일링**        | ❌ 수동 (서버 추가)           | ✅ 자동 (설정만)            |
| **무중단 배포**     | ❌ 직접 구현 (복잡)           | ✅ 기본 제공                |
| **로드밸런싱**      | ❌ Nginx 직접 설정            | ✅ ALB 자동 연동            |
| **로그**            | ❌ 직접 관리                  | ✅ CloudWatch 자동          |
| **모니터링**        | ❌ 직접 설정                  | ✅ CloudWatch 기본          |
| **SSH 접근**        | ✅ 가능                       | ❌ 불가 (ECS Exec으로 대체) |
| **디버깅**          | ✅ 쉬움 (서버 들어가서)       | ❌ 어려움 (로그로만)        |
| **초기 설정**       | 🟡 중간                       | 🔴 복잡                     |
| **장기 운영**       | 🔴 관리 부담                  | 🟢 편함                     |
| **비용**            | 🟢 $18/월                     | 🟡 $38/월 (24시간 기준)     |
| **비용 (8시간/일)** | 🟡 $18/월 (고정)              | 🟢 $13/월 (변동)            |
| **학습 곡선**       | 🟢 완만                       | 🔴 가파름                   |

---

## 실제 사용 경험 비교

### EC2로 배포했을 때

```
📅 월요일 오전
└── 새 기능 배포
    ├── 1. SSH 접속
    ├── 2. git pull
    ├── 3. docker-compose down
    ├── 4. docker-compose build
    ├── 5. docker-compose up -d
    └── 6. docker logs -f (에러 확인)
    ⏱️ 소요 시간: 10분

📅 수요일 새벽
└── 서버 다운 알림 📱
    ├── 1. SSH 접속
    ├── 2. docker ps (컨테이너 죽음 확인)
    ├── 3. docker logs (메모리 부족 확인)
    ├── 4. docker-compose restart
    └── 5. 다시 잠...💤
    ⏱️ 소요 시간: 30분 (잠 설침)

📅 금요일 오후
└── 트래픽 급증 🔥
    ├── 1. 서버 느려짐 확인
    ├── 2. 새 EC2 인스턴스 생성
    ├── 3. Docker 설치
    ├── 4. 앱 설정
    ├── 5. Nginx 로드밸런서 설정
    └── 6. 배포 완료
    ⏱️ 소요 시간: 1시간
```

### ECS Fargate로 배포했을 때

```
📅 월요일 오전
└── 새 기능 배포
    ├── 1. git commit & push
    └── 2. GitHub Actions가 자동 배포 ✅
    ⏱️ 소요 시간: 1분 (내가 하는 일)

📅 수요일 새벽
└── 컨테이너 죽음
    └── ECS가 자동으로 재시작 ✅
    ⏱️ 소요 시간: 0분 (자고 일어나면 해결됨)

📅 금요일 오후
└── 트래픽 급증 🔥
    └── Auto Scaling이 자동으로 Task 증설 ✅
        (설정만 해두면 끝)
    ⏱️ 소요 시간: 0분
```

---

## 언제 무엇을 사용할까

### EC2를 사용하는 게 좋을 때

#### 1. 학습 목적

```
✅ 추천 이유:
- 서버 관리 전체 프로세스 이해
- SSH로 직접 들어가서 확인 가능
- 문제 발생 시 직접 해결하며 배움
```

#### 2. 레거시 앱

```
✅ 추천 이유:
- Docker화되지 않은 앱
- 특정 OS 의존성이 있는 경우
- 컨테이너로 만들기 어려운 앱
```

#### 3. 복잡한 환경

```
✅ 추천 이유:
- 여러 서비스가 한 서버에 있어야 할 때
- GPU 필요 (P3 인스턴스 등)
- 특수한 네트워크 설정
```

#### 4. 비용 최적화 (장기)

```
✅ Reserved Instance 사용 시:
- 1년 계약: 40% 할인
- 3년 계약: 60% 할인
- 24시간 켜놓는 서비스
```

---

### ECS Fargate를 사용하는 게 좋을 때

#### 1. 프로덕션 서비스

```
✅ 추천 이유:
- 자동 복구, 스케일링
- 무중단 배포
- 운영 부담 최소화
```

#### 2. 마이크로서비스

```
✅ 추천 이유:
- 여러 서비스를 독립적으로 배포
- 각 서비스마다 스케일링 가능
- 서비스별 리소스 할당
```

#### 3. 트래픽 변동이 큰 서비스

```
✅ 추천 이유:
- 트래픽 많을 때만 Task 증가
- 적을 때 자동 감소
- 비용 최적화
```

#### 4. CI/CD 파이프라인

```
✅ 추천 이유:
- GitHub Actions 자동 배포
- 롤백 쉬움 (이전 버전 Task Definition 사용)
- Blue/Green 배포 가능
```

#### 5. 스타트업 / 빠른 개발

```
✅ 추천 이유:
- 인프라 관리 시간 최소화
- 개발에만 집중
- 초기에는 비용 큰 차이 없음
```

---

## 내 선택 기준

### 🟢 ECS Fargate 선택

```
다음 중 2개 이상 해당되면:
☑️ Docker를 이미 사용 중
☑️ 자동 배포가 중요함
☑️ 서버 관리하기 싫음
☑️ 트래픽 변동이 큼
☑️ 확장성이 중요함
☑️ 24시간 안 켜놔도 됨
```

### 🟡 EC2 선택

```
다음 중 2개 이상 해당되면:
☑️ 서버 관리 배우고 싶음
☑️ SSH 접속 필수
☑️ 비용 최소화가 최우선
☑️ 24시간 켜놔야 함
☑️ 레거시 앱 (Docker화 어려움)
☑️ 특수한 요구사항 있음
```

---

## 실전 팁

### EC2 → ECS 마이그레이션

```
1단계: Docker화 (로컬)
└── Dockerfile 작성
    └── docker-compose로 테스트

2단계: ECR에 푸시
└── 이미지를 ECR에 올림

3단계: ECS 설정
└── Task Definition, Service 생성

4단계: 트래픽 전환
└── Route53에서 DNS 변경
    (EC2 IP → ALB DNS)

5단계: 검증 후 EC2 종료
```

### 비용 절감 꿀팁

#### ECS Fargate

```bash
# 1. Fargate Spot 사용 (70% 할인!)
--capacity-provider-strategy capacityProvider=FARGATE_SPOT,weight=1

# 2. 사용하지 않을 때 Task 0으로
aws ecs update-service --desired-count 0

# 3. 야간 자동 중지 (Lambda 스케줄러)
평일 오전 9시 시작 → 오후 6시 중지
```

#### EC2

```bash
# 1. Reserved Instance (1년 계약)
40% 할인

# 2. Spot Instance (80% 할인!)
단, 중단될 수 있음

# 3. 사용하지 않을 때 중지
aws ec2 stop-instances --instance-ids i-xxxxx
```

---

## 결론

### 🎯 나의 선택: ECS Fargate

**이유:**

1. ✅ 서버 관리 시간 절약 → 개발에 집중
2. ✅ 자동 배포 (GitHub push → 배포 완료)
3. ✅ 자동 복구 (새벽에 안 깨어남)
4. ✅ 무중단 배포
5. ✅ 프로덕션 레벨 안정성

**단점 극복:**

- 초기 설정 복잡 → 한 번만 하면 됨
- 비용 약간 비쌈 → 시간 절약 가치가 더 큼
- 디버깅 어려움 → 로그 잘 쌓으면 해결

---

## 참고 자료

- [AWS ECS vs EC2 공식 비교](https://aws.amazon.com/ecs/)
- [Fargate 가격 계산기](https://aws.amazon.com/fargate/pricing/)
- [ECS Best Practices](https://docs.aws.amazon.com/AmazonECS/latest/bestpracticesguide/)

---

**최종 조언:**

- 학습 중이면 EC2로 시작 → 익숙해지면 ECS로 전환
- 프로덕션이면 처음부터 ECS Fargate 추천
- 둘 다 해보고 판단하는 게 최고! 👍
